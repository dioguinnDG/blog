{
  "hash": "d1a6f531fb310663c7b589673a5d689a",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Atividade Frota\"\nauthor: \"Diogo\"\ndate: \"2025-11-24\"\ncategories: [python, código, onibus]\nimage: bus.jpg\njupyter: python3\n---\n\nNeste post é possível ver o código da atividade da frota de ônibus.\n\n::: {#5b293232 .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nimport json\n\n#1: Configurações iniciais\nTOKEN_API = \"02bbec1a5bbe4c45e492ff11a9527973cc66b17670e5048de95b3da0372f8247\"\nlinha_id = \"307\"\n\n#2: Autenticação na API\nconexao = requests.Session()\nendpoint_login = f\"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar?token={TOKEN_API}\"\nresposta_login = conexao.post(endpoint_login)\n\nif resposta_login.status_code == 200 and resposta_login.json() is True:\n    print(\"Autenticação concluída com sucesso!\")\nelse:\n    print(\"Erro na autenticação. Verifique o token informado.\")\n\n#3: Buscar paradas da linha\nendpoint_paradas = f\"http://api.olhovivo.sptrans.com.br/v2.1/ParadaLinha?codigoLinha={linha_id}\"\nparadas_info = conexao.get(endpoint_paradas).json()\nif isinstance(paradas_info, str):\n    paradas_info = json.loads(paradas_info)\nelif isinstance(paradas_info, dict) and \"value\" in paradas_info:\n    paradas_info = paradas_info[\"value\"]\n\n#4: Buscar posição dos ônibus\nendpoint_veiculos = f\"http://api.olhovivo.sptrans.com.br/v2.1/Posicao?codigoLinha={linha_id}\"\nveiculos_info = conexao.get(endpoint_veiculos).json()\nif isinstance(veiculos_info, str):\n    veiculos_info = json.loads(veiculos_info)\nelif isinstance(veiculos_info, dict) and \"value\" in veiculos_info:\n    veiculos_info = veiculos_info[\"value\"]\n\n#5: Buscar trajeto da linha\nendpoint_trajeto = f\"http://api.olhovivo.sptrans.com.br/v2.1/Linha/Trajeto?codigoLinha={linha_id}\"\ntrajeto_info = conexao.get(endpoint_trajeto).json()\nif isinstance(trajeto_info, str):\n    trajeto_info = json.loads(trajeto_info)\nelif isinstance(trajeto_info, dict) and \"value\" in trajeto_info:\n    trajeto_info = trajeto_info[\"value\"]\n\n# Extrair coordenadas do trajeto\nrota_coordenadas = []\nif isinstance(trajeto_info, list):\n    for ponto in trajeto_info:\n        if \"Latitude\" in ponto and \"Longitude\" in ponto:\n            rota_coordenadas.append([ponto[\"Latitude\"], ponto[\"Longitude\"]])\n\n#6: Criar mapa\nmapa_linha = folium.Map(location=[-23.55, -46.63], zoom_start=12)\n\n# Adicionar trajeto (linha verde)\nif rota_coordenadas:\n    folium.PolyLine(rota_coordenadas, color=\"green\", weight=4, opacity=0.6,\n                    tooltip=\"Trajeto da linha\").add_to(mapa_linha)\n\n# Adicionar paradas (azul)\nif isinstance(paradas_info, list):\n    for parada in paradas_info:\n        if \"Latitude\" in parada and \"Longitude\" in parada:\n            folium.Marker(\n                location=[parada[\"Latitude\"], parada[\"Longitude\"]],\n                popup=f\"Parada: {parada.get('Denominacao', 'Sem nome')}\",\n                icon=folium.Icon(color=\"blue\", icon=\"info-sign\")\n            ).add_to(mapa_linha)\n\n# Adicionar ônibus em tempo real (vermelho)\nif isinstance(veiculos_info, dict) and \"vs\" in veiculos_info:\n    for veiculo in veiculos_info[\"vs\"]:\n        folium.Marker(\n            location=[veiculo[\"py\"], veiculo[\"px\"]],\n            popup=f\"Prefixo: {veiculo['p']}\",\n            icon=folium.Icon(color=\"red\", icon=\"bus\", prefix=\"fa\")\n        ).add_to(mapa_linha)\n\n#7: Salvar mapa\nmapa_linha.save(\"mapa_linha_onibus.html\")\nprint(\"Mapa gerado: abra 'mapa_linha_onibus.html' no navegador.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nErro na autenticação. Verifique o token informado.\nMapa gerado: abra 'mapa_linha_onibus.html' no navegador.\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}